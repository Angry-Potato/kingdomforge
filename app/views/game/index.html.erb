<!--- Main game page -->
<!--php $akihabara_dir = "game/akihabara"?>-->
<script type="text/javascript">
akihabara_dir = "javascripts/";
</script>
<%= javascript_include_tag "akihabara/gbox", "akihabara/iphopad", "akihabara/trigo", "akihabara/toys", "akihabara/help", "akihabara/tool", "akihabara/gamecycle" %>
<!-- <script type="text/javascript" src="/akihabara/gbox.js"></script>
  <script type="text/javascript" src="/akihabara/iphopad.js"></script>
  <script type="text/javascript" src="/akihabara/trigo.js"></script>
  <script type="text/javascript" src="/akihabara/toys.js"></script>
  <script type="text/javascript" src="/akihabara/help.js"></script>
  <script type="text/javascript" src="/akihabara/tool.js"></script>
  <script type="text/javascript" src="/akihabara/gamecycle.js"></script>-->
  <style>BODY { -webkit-user-select: none; margin: 0px }</style>
  <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" />
  <script>
  var maingame;
  
  window.addEventListener('load', loadResources, false);
  
  function loadResources() {
	  // This initializes Akihabara with the default settings.
	  // The title (which appears in the browser title bar) is the text we're passing to the function.
	  help.akihabaraInit('8by5');
	 
	  // Here we tell the game to look for an image called 'font.png' in the same directory as the HTML file and call it 'font' internally
	  gbox.addImage('font', '/images/font.png');
	 
	  // Same thing for our logo here.
	  gbox.addImage('logo', '/images/logo.png');
	 
	  // Fonts are mapped over an image, setting the first letter, the letter size, the length of all rows of letters and a horizontal/vertical gap.
	  gbox.addFont({ id: 'small', image: 'font', firstletter: ' ', tileh: 8, tilew: 8, tilerow: 255, gapx: 0, gapy: 0 });
	 
	  loadMap(0,0);
	  // When everything is ready, the 'loadAll' downloads all the needed resources, and then calls the function "main".
	  gbox.loadAll(main);
	}
	
	function loadMap(_global_x, _global_y) {
		
		$.get("/game/expand_tiles", { global_x: _global_x, global_y: _global_y },
		   function(data){
			 alert(data);
		   });
	
	/*
		return help.asciiArtToMap([
		"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
		"x                  xx                  x",
		"x                  xx                  x",
		"xxxxxxxx      x    xx                  x",
		"x             x    xxxxxxxxxx          x",
		"x             x                        x",
		"x             x                        x",
		"x     xxxx  xxxxxxxxx           xxxxxxxx",
		"x                  xx                  x",
		"x                  xx                  x",
		"xxxx               xx                  x",
		"x      xxxxxxxxx   xx                  x",
		"x                  xx                  x",
		"x                  xx        x         x",
		"xxxxxxx  xxxxxxxxxxxx        x         x",
		"xxxxxxx  xxxxxxxxxxxx        x         x",
		"x                  xx      xxxx        x",
		"x                  xx        x         x",
		"xxxxxxxx      x    xx        x         x",
		"x             x    xx                  x",
		"x             x    xx                  x",
		"x             x    xx                  x",
		"x     xxxx  xxxxxxxxx                  x",
		"x                  xx                  x",
		"xxxx                                   x",
		"x                                      x",
		"x      xxxxxxxxx   xx                  x",
		"x                  xx                  x",
		"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
			], [ [null, ' '], [0, 'x'] ])
	*/
	}
	
	function main() {
		gbox.setGroups(['game']);
		maingame = gamecycle.createMaingame('game', 'game');
 
		maingame.gameTitleIntroAnimation=function(reset) {
		  if (reset) {
		    toys.resetToy(this, 'rising');
		  }
		  gbox.blitFade(gbox.getBufferContext(),{ alpha: 1 });
		 
		  toys.logos.linear(this, 'rising', {
		    image: 'logo',
		    sx:    gbox.getScreenW()/2-gbox.getImage('logo').width/2,
		    sy:    gbox.getScreenH(),
		    x:     gbox.getScreenW()/2-gbox.getImage('logo').width/2,
		    y:     20,
		    speed: 1
		  });
		};
		
		maingame.pressStartIntroAnimation=function(reset) {
		  if (reset) {
		    toys.resetToy(this,"default-blinker");
		  } else {
		    toys.text.blink(this,"default-blinker",gbox.getBufferContext(),{font:"small",text:"PRESS Z TO START",valign:gbox.ALIGN_MIDDLE,halign:gbox.ALIGN_CENTER,dx:0,dy:Math.floor(gbox.getScreenH()/3),dw:gbox.getScreenW(),dh:Math.floor(gbox.getScreenH()/3)*2,blinkspeed:10});
		    return gbox.keyIsHit("a");
		    }
		};
 
		gbox.go();
	}
  
  </script>
